{% load static %}<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
</head>
<body>
<h1>- English -</h1>

   <textarea id="tes"></textarea>

    <audio id="present_audio"><source id="present_source" src="" type="audio/mpeg"></audio>
    <audio id="past_audio"><source id="past_source" src="" type="audio/mpeg"></audio>
    <audio id="past_participle_audio"><source id="past_participle_source" src="" type="audio/mpeg"></audio>

    <input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for names.." title="Type in a name">

    <button id="load">load</button>
    <button id="show">Show hidden fields</button>

    <input id="pivot" name="" type="hidden" value="0">
    <input id="present" name="" type="hidden" value="">
    <input id="past" name="" type="hidden" value="">
    <input id="past_participle" name="" type="hidden" value="">
    <input id="group" name="" type="hidden" value="">

    <input id="finished_routine" name="" type="hidden" value="">

</body>



<script src="{% static 'eg/js/jquery-3.1.1.min.js' %}"></script>
<script>


    $("#load").click(function(){
       if($('#finished_routine').val() != 'true'){
           next_verb();
       } else {
           alert('Haz finalizado la rutina ');
       }

    });



    $("#show").click(function(){
        alert($('#present').val());
    });

    function next_verb(){
      $.ajax({
        type: 'GET',
        url: 'next_verb',
        dataType: 'json',
        data:{'hi': $('#group').val()},
        success: function (data) {

          $('#present').val(data.present.verb);
          $("#present_source").attr("src", data.present.audio).detach().appendTo("#present_audio");
          var x = document.getElementById("present_audio");
          x.play();

          $('#past').val(data.past.verb);
          $("#past_source").attr("src", data.past.audio).detach().appendTo("#past_audio");

          $('#past_participle').val(data.past_participle.verb);
          $("#past_participle_source").attr("src", data.past_participle.audio).detach().appendTo("#past_participle_audio");

          $('#tes').val(data.present.verb + ' : ' + data.past.verb + ' : ' + data.past_participle.verb );

          var id = [];

            if($('#group').val()){
              id.push($('#group').val());
              id.push(data.id);
              $('#group').val(id);
            } else {
              id.push(data.id);
              $('#group').val(id);
            }
            //alert($('#group').val());
            $('#finished_routine').val(data.finished_routine);


        }
      });
    }


    function myFunction() {
        var input, verb;
        input = document.getElementById("myInput");
        verb = document.getElementById("present");
        past = document.getElementById("past");
        past_participle = document.getElementById("past_participle");

        pivot = document.getElementById("pivot");

            if( pivot.value == '0' && input.value.toUpperCase() == verb.value.toUpperCase()){
                $('#pivot').val('1');
                $('#myInput').val('');
                var x = document.getElementById("past_audio");
                x.play();
            }

            if( pivot.value == '1' && input.value.toUpperCase() == past.value.toUpperCase()){
                $('#pivot').val('2');
                $('#myInput').val('');
                var x = document.getElementById("past_participle_audio");
                x.play();
            }

            if( pivot.value == '2' && input.value.toUpperCase() == past_participle.value.toUpperCase()){
                $('#pivot').val('0');
                $('#myInput').val('');
                register_learned_word(verb.value);
                next_verb();
            }
    }


    function register_learned_word(learned_word) {
      {% if user.is_authenticated %}
        $.ajax({
             type:"POST",
             url:'{% url "register_learned_word" %}',
             dataType: 'json',
             data: {'learned_word':learned_word},
             success: function(data){
             }
        });
        return false;
      {% endif %}
    }

</script>

</html>