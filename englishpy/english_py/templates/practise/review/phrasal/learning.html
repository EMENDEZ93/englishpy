{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phrasal</title>
</head>
<body>
<h1>- Learning Phrasal -</h1>

    <textarea style="width: 80%;" id="test"></textarea>
    <input id="phrasal" name="" type="hidden" value="">
    <input id="present" name="present" type="hidden" value="">
    <audio id="audio"><source id="present_source" src="" type="audio/mpeg"></audio>
    <input type="text" style="width: 80%;" id="input" onkeyup="verify()" placeholder="Search for names.." title="Type in a name">

    <button id="load" onclick="next_phrasal()" >load</button>
    <button id="show" onclick="show_phrasal()">Show hidden fields</button>
    <button id="learned"  onclick="learned_phrasal()" >learned</button>

</body>

<script src="{% static 'eg/js/jquery-3.1.1.min.js' %}"></script>
<script>

    function show_phrasal(){
      alert($('#phrasal').val());
    }


    function next_phrasal(){
      $.ajax({
        type: 'GET',
        url: 'next_phrasal',
        dataType: 'json',
        data:{},
        async: false,
        success: function (data) {

           $('#phrasal').val(data.phrasal);
           $('#present').val(data.phrasal);
           $("#phrasal").attr('name', 'phrasal');
           $('#test').val(data.phrasal);

        }
      });
    }


    var sentence_number = 0;
    function get_sentence(sentence_number_){
      sentence_number = sentence_number_;
      $.ajax({
        type: 'GET',
        url: 'get_sentence/'+sentence_number+'/'+$('#present').val(),
        dataType: 'json',
        data:{},
        async: false,
        success: function (data) {


           $('#phrasal').val(data.sentence);
           $("#phrasal").attr('name', 'sentence');
           $('#test').val(data.sentence);

           sentence_number--;

        }
      });
    }


    function get_sentence_number(){
      $.ajax({
        type: 'GET',
        url: 'get_sentence_number/'+$('#present').val(),
        dataType: 'json',
        data:{},
        async: false,
        success: function (data) {

           if( data.sentence_number == 0 ){
             learned_phrasal();
             next_verb();

           } else if( data.sentence_number > 0 ){
             get_sentence(data.sentence_number);
           }

        }
      });
    }


    function learned_word(){
      $.ajax({
        type: 'GET',
        url: 'learned_word/'+$('#present').val(),
        dataType: 'json',
        data:{},
        async: false,
        success: function (data) {
        }
      });
    }


    function verify(){
       if( $('#phrasal').val().toLowerCase() == $('#input').val().toLowerCase() && $('#input').val().toLowerCase() != ''){

           if( $("#phrasal").attr('name') == 'past_participle' ){
             get_sentence_number();

           } else if( $("#phrasal").attr('name') == 'sentence' ){

                if( sentence_number == 0 ){
                  learned_word();
                  next_phrasal();
                } else if( sentence_number > 0 ){
                  get_sentence(sentence_number);
                }

           }
           $('#input').val('');

       }
    }


</script>

</html>